# aerial_multi_robot_open_project
UWB Simulator

## To launch a simple world (from inside the main folder):

1.      colcon build
2.      source install/setup.bash
3. (To export the Turtlebot models- maybe this could be inside a sh file?) 
        
        export GAZEBO_MODEL_PATH=$GAZEBO_MODEL_PATH:$(pwd)/install/robots_description/share/robots_description/models
4.      export TURTLEBOT3_MODEL=waffle_pi
5.      ros2 launch uwb_simulator simple_world.launch.py


## Parameters to configure when launching the application:

- **robots**: They can be a list of names, or a list of each robot describing their position (see example).
  - Option 1:
  -     - T01:
          x: 1.0
          y: 1.5
        - T02:
          x: 2.0
          y: 1.5
  - Option 2:
  -     - T01
        - T02
- **uwb_nodes**: They define the same list of names as in the robots list, but they also define for each robot the number of antennas and the names that they will be asigned. Adding the position of each antenna (relative to the center of the robot) is optional. It is mandatory to include the information for all the robots declared in the **robots** section.
  - Example:   
  -     T01:
          num_antennas: 1
          names: [
            "A",
          ]
          positions: [
            [0.5, 0.5, 0],
          ]
- **uwb_ranges**: They configure how to measure the ranges between the antennas.

  - *ground_truth*: Name of the robot that will be used as ground truth. Meaning that all the other antennas will measure their distance against this robot but not between themselves. **This only applies if type_measurement is set to _origin_**
  - *type_measurement*: Determines the method to compute the ranges between the antennas. The distances between the antennas of the same robot are never computed
    - *"all"*: all the distances or ranges between all the pairs of antennas are computed.
    - *"origin"*: the distances or ranges between all the antennas and the ground truth are computed (but not between the antennas that are not ground truth)
  - *localization_method*: Determines the method to compute the absolute or relative positions of the robot based on the ranges measured in the simulator. These estimated positions are saved in a external file.
    - *"lse"*: Uses a least squares error estimator to compute the absolute positions of the robots.
    - *"trilat"*: Uses trilateration to compute the relative positions of the robots.
      - **This method only works while using one antenna per robot.**
    - Any other string: Disables this option and no estimation is done.
  - *write_to_file*: A flag that allows writing a file containing key information from the simulator. It includes the ranges as columns, absolute positions (or real positions) as well as estimated positions if the a method is selected
  - *max_twr_freq*: Frequency at which the simulator computes the ranges for each pair of antennas (every X Hz a new measurement is computed and published)
  - *duty_cycle*: ?
  - *mean*: Mean of the Gaussian distribution modelling of the ranges measurements noise (normally the value is zero)
  - *std_dev*: Standard deviation of the Gaussian distribution modelling of the ranges measurements noise.
  - *ranges*: A list of the robots that are not ground truth robots, the ranges measurements will be computed for this robots (between these robots and the ground truth robot defined before).

- **demo_trajectory**: A flag that activates the movement of robots in a pre-defined trajectory.

## Outputs of the simulation

### Gazebo
- The robots appear in Gazebo and are available for use without any modification or requirement.
- The world for the simulation can change by changing the file in the launch file configuration. The current empty world is inside the *robots_description/worlds* folder.

### ROS2 Topics and Data
- All the normally available topics for the robots spawned in Gazebo should also be available once the simulation starts.
- Some additional topics are added as a result of the UWB Simulator features, these include:
  - *Ranges measurements topics*: They are in the form of *from_UWB **ANTENNA_to_ANOTHER UWB ANTENNA**. They will appear according to the ranges measurement type. These topics are similar to the ones generated by UWB Sensors in a real scenario.
  - *True antennas positions*: These topics contain the transformations with the true or absolute positions of the antennas in the simulator world. There is one topic per robot in the form of **ROBOT NAME_antennas**.
- Additionally, the transformations created for the antennas are published in the **/tf** general topic, and they contain all the transformations used in the simulator to compute the ranges.

### Files
- A CSV containing relevant information useful for localization algorithms and validation checks. These CSV compiles the data generated by the simulator every 1 second and saves it in the file. The file contains the following columns and corresponding data:
  - All the ranges measurements from all the pairs of antennas (according to the measurement type selected) - each row represents an individual moment in time when the measurement was saved.
  - The absolute or true position of the antennas in the simulator (Gazebo). Each element is an object that can be transformed to a list or array, and it contains the x, y, z location of the antenna in the simulation world.

## Run a trajectory demo for the robots in the simulator

We have added the functionality to run a node that moves the robots in the simulator in a predefined trajectory. This could be helpful as an example to how to interact with the robots in the simulator and also to get data from the UWB Sensors measurements without the need of building a script from scratch. To activate the movement of the robots (or to allow the robots to do the trajectory) is necessary to change the following flag in the simulation.yaml configuration:
  - **demo_trajectory** : *True*. To disable it it is only necessary to change it to *False*.
  - *Expected behavior*: The Tello drones will move around its initial position following a circle with a pre-defined radius. The Turtlebots will move back and forth around its initial position a pre-defined distance.
